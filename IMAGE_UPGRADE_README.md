# üé® –ú–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

## ‚ú® –ß—Ç–æ –Ω–æ–≤–æ–≥–æ?

### –î–ª—è –∑–∞–∫–∞–∑—á–∏–∫–∞ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

**–í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –æ–±—Ä–µ–∑–∫–∏:**
1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ä–µ–¥–∞–∫—Ç–æ—Ä —Å –ø—Ä–µ–≤—å—é
3. –í—ã–±–∏—Ä–∞–µ—Ç–µ –æ–±–ª–∞—Å—Ç—å, –º–∞—Å—à—Ç–∞–±, –ø–æ–≤–æ—Ä–æ—Ç
4. –í–∏–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏
5. –ù–∞–∂–∏–º–∞–µ—Ç–µ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å"

**–ë–æ–ª—å—à–µ –Ω–∏–∫–∞–∫–∏—Ö:**
- ‚ùå –î–æ–≥–∞–¥–æ–∫ –æ —Ä–∞–∑–º–µ—Ä–∞—Ö
- ‚ùå –ë–µ–ª—ã—Ö –ø–æ–ª–µ–π –Ω–∞ —Ñ–æ–Ω–µ
- ‚ùå –ü—Ä–æ–±–ª–µ–º —Å —Ñ–æ—Ä–º–∞—Ç–∞–º–∏
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–æ–ø–æ—Ä—Ü–∏–π

**–¢–µ–ø–µ—Ä—å –µ—Å—Ç—å:**
- ‚úÖ –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π crop-—Ä–µ–¥–∞–∫—Ç–æ—Ä
- ‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω
- ‚úÖ –ü–æ–¥—Å–∫–∞–∑–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–µ–≤—å—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω –≤–º–µ—Å—Ç–æ –±–µ–ª–æ–≥–æ (`alpha: 0`)
- React Easy Crop –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ä—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –î–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

–ù–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å! –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏:

```bash
pnpm dev
```

### –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

#### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
pnpm migrate:images:dry
```

–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, —Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ.

#### –®–∞–≥ 2: –ú–∏–≥—Ä–∞—Ü–∏—è

```bash
pnpm migrate:images
```

–°–∫—Ä–∏–ø—Ç:
- –ù–∞–π–¥–µ—Ç –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º —Ñ–æ–Ω–æ–º
- –û—Å—Ç–∞–≤–∏—Ç –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏
- –ü–æ–∫–∞–∂–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~1-2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **`IMAGE_MIGRATION_GUIDE.md`** - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- **`CHANGELOG_IMAGES.md`** - –î–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. API Upload

```diff
- const bg = { r: 255, g: 255, b: 255, alpha: 1 }
+ const bg = { r: 255, g: 255, b: 255, alpha: 0 }
```

### 2. Admin Form

- –î–æ–±–∞–≤–ª–µ–Ω `ImageCropModal` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- Crop –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
- –ü—Ä–µ–≤—å—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### 3. –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

```
app/
‚îú‚îÄ‚îÄ admin/components/imageCropModal/
‚îÇ   ‚îú‚îÄ‚îÄ index.tsx
‚îÇ   ‚îî‚îÄ‚îÄ index.module.scss
‚îú‚îÄ‚îÄ utils/cropImage.ts
‚îî‚îÄ‚îÄ lib/imageVariants.ts (–æ–±–Ω–æ–≤–ª–µ–Ω)

scripts/
‚îî‚îÄ‚îÄ migrate-images.ts
```

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

1. **–ì–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**
   - –ù–∞–∂–º–∏—Ç–µ "–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª"
   - –û–±—Ä–µ–∂—å—Ç–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–≤–∞—Ä

2. **–ì–∞–ª–µ—Ä–µ—è:**
   - –ù–∞–∂–º–∏—Ç–µ "+ –§–æ—Ç–æ"
   - –û–±—Ä–µ–∂—å—Ç–µ –∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
   - –î–æ 4 —Ñ–æ—Ç–æ

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ

```tsx
import { variantUrl } from '@/app/lib/imageVariants'
import { readFile } from '@/app/utils/cropImage'
import ImageCropModal from '@/app/admin/components/imageCropModal'

// –ü–æ–ª—É—á–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
const cardUrl = variantUrl(product.img, 'card')

// Crop —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
const imageSrc = await readFile(file)
// ... –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ ImageCropModal
```

## üì¶ –ù–æ–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å

```json
{
  "react-easy-crop": "^5.5.3"
}
```

## üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

**100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- –°—Ç–∞—Ä—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
- –ù–æ–≤—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª—É—á—à–µ
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤–æ–∑–º–æ–∂–Ω–∞
- –û—Ç–∫–∞—Ç –¥–æ—Å—Ç—É–ø–µ–Ω

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **Crop:** –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (Canvas API)
- **–ó–∞–≥—Ä—É–∑–∫–∞:** –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–†–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞:** +15KB (gzipped)
- **–ú–∏–≥—Ä–∞—Ü–∏—è:** ~1-2 —Å–µ–∫/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

## üé® Crop-—Ä–µ–¥–∞–∫—Ç–æ—Ä

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ú–∞—Å—à—Ç–∞–± (1x - 3x)
- –ü–æ–≤–æ—Ä–æ—Ç (0¬∞ - 360¬∞)
- –ü—Ä–æ–ø–æ—Ä—Ü–∏–∏: 1:1, 3:2, 2:3, 16:9, —Å–≤–æ–±–æ–¥–Ω–æ
- Touch-friendly
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏:**
- –ì–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ: **1:1** (–∫–≤–∞–¥—Ä–∞—Ç)
- –ì–∞–ª–µ—Ä–µ—è: **1:1** –∏–ª–∏ **3:2**

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- Magic bytes validation
- Rate limiting
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –õ–∏–º–∏—Ç—ã —Ä–∞–∑–º–µ—Ä–æ–≤ (2MB)

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ß—Ç–æ —É–ª—É—á—à–∏–ª–æ—Å—å

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ë—ã–ª–æ | –°—Ç–∞–ª–æ |
|----------|------|-------|
| UX –¥–ª—è –∞–¥–º–∏–Ω–∞ | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| –ö–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| –ö–æ–Ω—Ç—Ä–æ–ª—å | ‚ùå | ‚úÖ |
| –ë–µ–ª—ã–µ –ø–æ–ª—è | ‚ùå | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |

## üÜò –ü–æ–º–æ—â—å

### –ü—Ä–æ–±–ª–µ–º—ã —Å crop?

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±—Ä–∞—É–∑–µ—Ä (–Ω—É–∂–µ–Ω Canvas API)
2. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ console –Ω–∞ –æ—à–∏–±–∫–∏

### –ü—Ä–æ–±–ª–µ–º—ã —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π?

```bash
# –°–Ω–∞—á–∞–ª–∞ dry-run
pnpm migrate:images:dry

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞
ls -la public/uploads/

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
pnpm migrate:images -- --force
```

### –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
# –û—Ç–∫–∞—Ç –∫–æ–¥–∞
git revert <commit>

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
cp -r public/uploads.backup/* public/uploads/
```

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

- [x] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ `react-easy-crop`
- [x] –°–æ–∑–¥–∞–Ω `ImageCropModal` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `API upload` (alpha: 0)
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω crop –≤ `adminForm`
- [x] –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —Ç–∏–ø—ã TypeScript
- [ ] –ó–∞–ø—É—â–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω crop –≤ –∞–¥–º–∏–Ω–∫–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

## üéâ –ì–æ—Ç–æ–≤–æ!

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –í—Å–µ –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∞ —Å—Ç–∞—Ä—ã–µ –º–æ–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.

**–ü—Ä–∏—è—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã! üöÄ**

---

*–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã - —á–∏—Ç–∞–π—Ç–µ `IMAGE_MIGRATION_GUIDE.md`*
